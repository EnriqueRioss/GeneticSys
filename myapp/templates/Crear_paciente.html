{% extends 'layouts/base2.html' %}
{% load static %}

{% block form_content %}
<head>
    <title>Datos del Propósito</title>
    <link rel="stylesheet" href="{% static '/styles/stylesforms.css' %}">
</head>


<div class="contenedor-formulario">
    <form method="post" enctype="multipart/form-data" id="crear-paciente-form">
        {% csrf_token %}

        <div class="form-step active">
            <div class="step-content-header">
                <i class="fas fa-user"></i>
                <h2>Datos del Propósito</h2>
            </div>

            <p class="step-subtitle">Datos básicos del paciente</p>

            <p class="historia-info">Nº de Historia Clínica: {{ historia.numero_historia }}</p>
            {% if editing %}
                <p class="editing-info"><em>Modo Edición: Actualizando datos del propósito.</em></p>
            {% endif %}


            <div class="alert alert-danger non-field-errors"></div>

            <div id="proposito-diagnostico-section">
            
                <div class="form-group-medio">
                    <div class="half-width">
                        <label for="{{ form.nombres.id_for_label }}">Nombres</label>
                        {{ form.nombres }}
                        <div class="field-errors" id="error_{{ form.nombres.id_for_label }}"></div>
                    </div>
                    <div class="half-width">
                        <label for="{{ form.apellidos.id_for_label }}">Apellidos</label>
                        {{ form.apellidos }}
                        <div class="field-errors" id="error_{{ form.apellidos.id_for_label }}"></div>
                    </div>
                </div>
                <div class="form-group-medio">
                    <div class="half-width">
                        <label for="{{ form.sexo.id_for_label }}">Sexo</label>
                        {{ form.sexo }}
                        <div class="field-errors" id="error_{{ form.sexo.id_for_label }}"></div>
                    </div>
                    <div class="half-width">
                        <label for="{{ form.fecha_nacimiento.id_for_label }}">Fecha de Nacimiento</label>
                        {{ form.fecha_nacimiento }}
                        <div class="field-errors" id="error_{{ form.fecha_nacimiento.id_for_label }}"></div>
                    </div>
                </div>
                <div class="form-group-medio">
                    <div class="half-width">
                        <label for="{{ form.lugar_nacimiento.id_for_label }}">Lugar de Nacimiento</label>
                        {{ form.lugar_nacimiento }}
                        <div class="field-errors" id="error_{{ form.lugar_nacimiento.id_for_label }}"></div>
                    </div>
                    <div class="half-width">
                        <label for="{{ form.identificacion.id_for_label }}">Identificación</label>
                        {{ form.identificacion }}
                        <div class="field-errors" id="error_{{ form.identificacion.id_for_label }}"></div>
                    </div>
                </div>
                <div class="form-group-medio">
                    <div class="half-width">
                        <label for="{{ form.escolaridad.id_for_label }}">Escolaridad</label>
                        {{ form.escolaridad }}
                        <div class="field-errors" id="error_{{ form.escolaridad.id_for_label }}"></div>
                    </div>
                    <div class="half-width">
                        <label for="{{ form.ocupacion.id_for_label }}">Ocupación</label>
                        {{ form.ocupacion }}
                        <div class="field-errors" id="error_{{ form.ocupacion.id_for_label }}"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.edad.id_for_label }}">Edad</label>
                    {{ form.edad }}
                    <div class="field-errors" id="error_{{ form.edad.id_for_label }}"></div>
                </div>
                <div class="form-group-medio">
                    <div class="half-width">
                        <label for="{{ form.grupo_sanguineo.id_for_label }}">Grupo Sanguíneo</label>
                        {{ form.grupo_sanguineo }}
                        <div class="field-errors" id="error_{{ form.grupo_sanguineo.id_for_label }}"></div>
                    </div>
                    <div class="half-width">
                        <label for="{{ form.factor_rh.id_for_label }}">Factor RH</label>
                        {{ form.factor_rh }}
                        <div class="field-errors" id="error_{{ form.factor_rh.id_for_label }}"></div>
                    </div>
                </div>
                <div class="form-group-medio">
                    <div class="half-width">
                        <label for="{{ form.telefono.id_for_label }}">Teléfono</label>
                        {{ form.telefono }}
                        <div class="field-errors" id="error_{{ form.telefono.id_for_label }}"></div>
                    </div>
                    <div class="half-width">
                        <label for="{{ form.email.id_for_label }}">Email</label>
                        {{ form.email }}
                        <div class="field-errors" id="error_{{ form.email.id_for_label }}"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="{{ form.direccion.id_for_label }}">Dirección</label>
                    {{ form.direccion }}
                    <div class="field-errors" id="error_{{ form.direccion.id_for_label }}"></div>
                </div>
                <div class="form-group">
                        <label for="{{ form.foto.id_for_label }}">Foto del Propósito</label>
                        {{ form.foto }}
                        <div class="field-errors" id="error_{{ form.foto.id_for_label }}"></div>
                    </div>
            </div>

            <!-- BOTONES CONDICIONALES -->
            <div class="form-actions">
                {% if from_gestion %}
                <button type="button" class="btn btn-secondary" onclick="window.location.href='{% url 'gestion_pacientes' %}'">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                {% else %}
                    <button type="button" class="btn btn-secondary" onclick="window.history.back()">Anterior</button>
                    <button type="submit" name="save_draft" class="btn btn-outline">Guardar Borrador</button>
                    <button type="submit" class="btn btn-primary" id="nextBtn">Siguiente</button>
                {% endif %}
            </div>

        </div>
        
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    setupAjaxForm('crear-paciente-form');
});
</script>

{% endblock form_content %}